(()=>{"use strict";var e={n:t=>{var n=t&&t.__esModule?()=>t.default:()=>t;return e.d(n,{a:n}),n},d:(t,n)=>{for(var a in n)e.o(n,a)&&!e.o(t,a)&&Object.defineProperty(t,a,{enumerable:!0,get:n[a]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};const t=window.wp.element,n=window.wp.i18n,a=window.wp.plugins,s=window.wp.editPost,r=window.moment;var i=e.n(r);function o(){return"gp_event"===wp.data.select("core/editor").getCurrentPostType()}function l(){wp.data.dispatch("core/editor").editPost({meta:{_non_existing_meta:!0}})}const d=window.wp.components,m=window.wp.data,c=window.wp.apiFetch;var u=e.n(c);const p=window.React,_=window.wp.date,h=function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];for(const[n,a]of Object.entries(e)){let e=n;t&&(e+=t);const s=new CustomEvent(e,{detail:a});dispatchEvent(s)}};function g(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;S(e),GatherPress.event_datetime.datetime_start=e,this.setState({dateTime:e}),null!==t&&t({dateTime:e});const n={setDateTimeStart:e};h(n),l()}function v(){return GatherPress.event_datetime.datetime_start=this.state.dateTime,this.state.dateTime}class w extends p.Component{constructor(e){super(e),this.state={dateTime:GatherPress.event_datetime.datetime_start}}componentDidMount(){this.updateDateTimeStart=g,this.getDateTimeStart=v,g=g.bind(this),v=v.bind(this)}componentWillUnmount(){g=this.updateDateTimeStart,v=this.getDateTimeStart}render(){const e=(0,_.__experimentalGetSettings)();return(0,_.dateI18n)(`${e.formats.date} ${e.formats.time}`,this.state.dateTime)}}function f(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;G(e),GatherPress.event_datetime.datetime_end=e,this.setState({dateTime:e}),null!==t&&t({dateTime:e});const n={setDateTimeEnd:e};h(n),l()}function E(){return GatherPress.event_datetime.datetime_end=this.state.dateTime,P(),this.state.dateTime}function P(){const e="gp_event_past",t=wp.data.dispatch("core/notices"),a=i()().valueOf()>i()(GatherPress.event_datetime.datetime_end).valueOf();t.removeNotice(e),a&&t.createNotice("warning",(0,n.__)("This event has already past.","gatherpress"),{id:e,isDismissible:!0})}class T extends p.Component{constructor(e){super(e),this.state={dateTime:GatherPress.event_datetime.datetime_end}}componentDidMount(){this.updateDateTimeEnd=f,this.getDateTimeEnd=E,f=f.bind(this),E=E.bind(this),P()}componentWillUnmount(){f=this.updateDateTimeEnd,E=this.getDateTimeEnd}componentDidUpdate(){P()}render(){const e=(0,_.__experimentalGetSettings)();return(0,_.dateI18n)(`${e.formats.date} ${e.formats.time}`,this.state.dateTime)}}const D="YYYY-MM-DDTHH:mm:ss";function S(e){const t=i()(GatherPress.event_datetime.datetime_end).valueOf(),n=i()(e).valueOf();n>=t&&f(i()(n).add(2,"hours").format(D)),P()}function G(e){const t=i()(GatherPress.event_datetime.datetime_start).valueOf(),n=i()(e).valueOf();n<=t&&g(i()(n).subtract(2,"hours").format(D)),P()}const b=window.wp.compose,x=(0,b.withState)()((e=>{let{setState:n}=e;const a=(0,_.__experimentalGetSettings)(),s=/a(?!\\)/i.test(a.formats.time.toLowerCase().replace(/\\\\/g,"").split("").reverse().join(""));return(0,t.createElement)(d.DateTimePicker,{currentDate:v(),onChange:e=>g(e,n),is12Hour:s})})),C=(0,b.withState)()((e=>{let{setState:n}=e;const a=(0,_.__experimentalGetSettings)(),s=/a(?!\\)/i.test(a.formats.time.toLowerCase().replace(/\\\\/g,"").split("").reverse().join(""));return(0,t.createElement)(d.DateTimePicker,{currentDate:E(),onChange:e=>f(e,n),is12Hour:s})})),O=i()().format(D);let Y=GatherPress.event_datetime.datetime_start,y=GatherPress.event_datetime.datetime_end;(0,m.subscribe)((function(){const e=wp.data.select("core/editor").isSavingPost(),t=wp.data.select("core/editor").isAutosavingPost();o()&&e&&!t&&u()({path:"/gatherpress/v1/event/datetime/",method:"POST",data:{post_id:GatherPress.post_id,datetime_start:i()(GatherPress.event_datetime.datetime_start).format("YYYY-MM-DD HH:mm:ss"),datetime_end:i()(GatherPress.event_datetime.datetime_end).format("YYYY-MM-DD HH:mm:ss"),_wpnonce:GatherPress.nonce}}).then((()=>{}))})),Y=""!==Y?i()(Y).format(D):O,y=""!==y?i()(y).format(D):i()(O).add(2,"hours").format(D),GatherPress.event_datetime.datetime_start=Y,GatherPress.event_datetime.datetime_end=y;const M=()=>(0,t.createElement)("section",null,(0,t.createElement)("h3",null,(0,n.__)("Date & time","gatherpress")),(0,t.createElement)(d.PanelRow,null,(0,t.createElement)("span",null,(0,n.__)("Start","gatherpress")),(0,t.createElement)(d.Dropdown,{position:"bottom left",renderToggle:e=>{let{isOpen:n,onToggle:a}=e;return(0,t.createElement)(d.Button,{onClick:a,"aria-expanded":n,isLink:!0},(0,t.createElement)(w,null))},renderContent:()=>(0,t.createElement)(x,null)})),(0,t.createElement)(d.PanelRow,null,(0,t.createElement)("span",null,(0,n.__)("End","gatherpress")),(0,t.createElement)(d.Dropdown,{position:"bottom left",renderToggle:e=>{let{isOpen:n,onToggle:a}=e;return(0,t.createElement)(d.Button,{onClick:a,"aria-expanded":n,isLink:!0},(0,t.createElement)(T,null))},renderContent:()=>(0,t.createElement)(C,null)}))),H=e=>{const{venue:a,setVenue:s}=e,r=(0,m.useDispatch)("core/editor").editPost,{unlockPostSaving:i}=(0,m.useDispatch)("core/editor"),o=(0,m.useSelect)((e=>e("core/editor").getEditedPostAttribute("_gp_venue"))),l=(0,m.useSelect)((e=>e("core").getEntityRecord("taxonomy","_gp_venue",o)))?.slug.replace("_venue_",""),c=o+":"+l;(0,t.useEffect)((()=>{var e;s(null!==(e=String(c))&&void 0!==e?e:""),h({setVenueId:l})}));let u=(0,m.useSelect)((e=>e("core").getEntityRecords("taxonomy","_gp_venue",{per_page:-1,context:"view"})),[a]);return u?(u=u.map((e=>({label:e.name,value:e.id+":"+e.slug.replace("_venue_","")}))),u.unshift({value:"",label:(0,n.__)("Choose a venue","gatherpress"),disabled:!0})):u=[],(0,t.createElement)(d.PanelRow,null,(0,t.createElement)(d.Flex,null,(0,t.createElement)(d.FlexItem,null,(0,n.__)("Venue","gatherpress")),(0,t.createElement)(d.FlexItem,null,(0,t.createElement)(d.SelectControl,{label:(0,n.__)("Venue","gatherpress"),hideLabelFromVision:"true",value:a,onChange:e=>{(e=>{s(e),e=e.split(":"),r({_gp_venue:[e[0]]}),h({setVenueId:e[1]}),i()})(e)},options:u,style:{width:"11rem"}}))))};(0,a.registerPlugin)("gp-event-settings",{render:()=>{const[e,a]=(0,t.useState)("");return o()&&(0,t.createElement)(s.PluginDocumentSettingPanel,{name:"gp-event-settings",title:(0,n.__)("Event settings","gatherpress"),initialOpen:!0,className:"gp-event-settings"},(0,t.createElement)(M,null),(0,t.createElement)("hr",null),(0,t.createElement)(H,{venue:e,setVenue:a}))},icon:""})})();