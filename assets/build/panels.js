(()=>{"use strict";var e={n:t=>{var n=t&&t.__esModule?()=>t.default:()=>t;return e.d(n,{a:n}),n},d:(t,n)=>{for(var a in n)e.o(n,a)&&!e.o(t,a)&&Object.defineProperty(t,a,{enumerable:!0,get:n[a]})}};e.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),e.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t);const t=window.wp.element,n=window.moment;var a=e.n(n);const s=window.wp.i18n;function r(){wp.data.dispatch("core/editor").editPost({meta:{_non_existing_meta:!0}})}function i(){return a()().valueOf()>a()(GatherPress.event_datetime.datetime_end).valueOf()}const o=window.wp.components,d=window.wp.apiFetch;var l=e.n(d);const m=window.React,c=window.wp.date;function u(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;P(e),GatherPress.event_datetime.datetime_start=e,this.setState({dateTime:e}),null!==t&&t({dateTime:e}),r()}function p(){return GatherPress.event_datetime.datetime_start=this.state.dateTime,this.state.dateTime}class h extends m.Component{constructor(e){super(e),this.state={dateTime:GatherPress.event_datetime.datetime_start}}componentDidMount(){this.updateDateTimeStart=u,this.getDateTimeStart=p,u=u.bind(this),p=p.bind(this)}componentWillUnmount(){u=this.updateDateTimeStart,p=this.getDateTimeStart}render(){const e=(0,c.__experimentalGetSettings)();return(0,c.dateI18n)(`${e.formats.date} ${e.formats.time}`,this.state.dateTime)}}function _(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;E(e),GatherPress.event_datetime.datetime_end=e,this.setState({dateTime:e}),null!==t&&t({dateTime:e}),r()}function g(){return GatherPress.event_datetime.datetime_end=this.state.dateTime,v(),this.state.dateTime}function v(){const e="gp_event_past",t=wp.data.dispatch("core/notices"),n=i();t.removeNotice(e),n&&t.createNotice("warning",(0,s.__)("This event has already past.","gatherpress"),{id:e,isDismissible:!0})}class w extends m.Component{constructor(e){super(e),this.state={dateTime:GatherPress.event_datetime.datetime_end}}componentDidMount(){this.updateDateTimeEnd=_,this.getDateTimeEnd=g,_=_.bind(this),g=g.bind(this),v()}componentWillUnmount(){_=this.updateDateTimeEnd,g=this.getDateTimeEnd}componentDidUpdate(){v()}render(){const e=(0,c.__experimentalGetSettings)();return(0,c.dateI18n)(`${e.formats.date} ${e.formats.time}`,this.state.dateTime)}}const f="YYYY-MM-DDTHH:mm:ss";function P(e){const t=a()(GatherPress.event_datetime.datetime_end).valueOf(),n=a()(e).valueOf();n>=t&&_(a()(n).add(2,"hours").format(f)),v()}function E(e){const t=a()(GatherPress.event_datetime.datetime_start).valueOf(),n=a()(e).valueOf();n<=t&&u(a()(n).subtract(2,"hours").format(f)),v()}const T=window.wp.compose,D=(0,T.withState)()((e=>{let{setState:n}=e;const a=(0,c.__experimentalGetSettings)(),s=/a(?!\\)/i.test(a.formats.time.toLowerCase().replace(/\\\\/g,"").split("").reverse().join(""));return(0,t.createElement)(o.DateTimePicker,{currentDate:p(),onChange:e=>u(e,n),is12Hour:s})})),b=(0,T.withState)()((e=>{let{setState:n}=e;const a=(0,c.__experimentalGetSettings)(),s=/a(?!\\)/i.test(a.formats.time.toLowerCase().replace(/\\\\/g,"").split("").reverse().join(""));return(0,t.createElement)(o.DateTimePicker,{currentDate:g(),onChange:e=>_(e,n),is12Hour:s})})),S=a()().format(f);let G=GatherPress.event_datetime.datetime_start,O=GatherPress.event_datetime.datetime_end;wp.data.subscribe((function(){const e=wp.data.select("core/editor").isSavingPost(),t=wp.data.select("core/editor").isAutosavingPost();e&&!t&&l()({path:"/gatherpress/v1/event/datetime/",method:"POST",data:{post_id:GatherPress.post_id,datetime_start:a()(GatherPress.event_datetime.datetime_start).format("YYYY-MM-DD HH:mm:ss"),datetime_end:a()(GatherPress.event_datetime.datetime_end).format("YYYY-MM-DD HH:mm:ss"),_wpnonce:GatherPress.nonce}}).then((()=>{}))})),G=""!==G?a()(G).format(f):S,O=""!==O?a()(O).format(f):a()(S).add(2,"hours").format(f),GatherPress.event_datetime.datetime_start=G,GatherPress.event_datetime.datetime_end=O;const C=()=>(0,t.createElement)("section",null,(0,t.createElement)("h3",null,(0,s.__)("Date & time","gatherpress")),(0,t.createElement)(o.PanelRow,null,(0,t.createElement)("span",null,(0,s.__)("Start","gatherpress")),(0,t.createElement)(o.Dropdown,{position:"bottom left",renderToggle:e=>{let{isOpen:n,onToggle:a}=e;return(0,t.createElement)(o.Button,{onClick:a,"aria-expanded":n,isLink:!0},(0,t.createElement)(h,null))},renderContent:()=>(0,t.createElement)(D,null)})),(0,t.createElement)(o.PanelRow,null,(0,t.createElement)("span",null,(0,s.__)("End","gatherpress")),(0,t.createElement)(o.Dropdown,{position:"bottom left",renderToggle:e=>{let{isOpen:n,onToggle:a}=e;return(0,t.createElement)(o.Button,{onClick:a,"aria-expanded":n,isLink:!0},(0,t.createElement)(w,null))},renderContent:()=>(0,t.createElement)(b,null)}))),{__:Y}=wp.i18n;class x extends m.Component{constructor(e){super(e),this.state={announceEventSent:"0"!==GatherPress.event_announced}}announce(){e.g.confirm(Y("Ready to announce this event to all members?","gatherpress"))&&l()({path:"/gatherpress/v1/event/announce/",method:"POST",data:{post_id:GatherPress.post_id,_wpnonce:GatherPress.nonce}}).then((e=>{GatherPress.event_announced=e.success?"1":"0",this.setState({announceEventSent:e.success})}))}shouldDisable(){return this.state.announceEventSent||"publish"!==wp.data.select("core/editor").getEditedPostAttribute("status")||i()}render(){return(0,t.createElement)("section",null,(0,t.createElement)("h3",null,Y("Options","gatherpress")),(0,t.createElement)(o.PanelRow,null,(0,t.createElement)("span",null,Y("Announce event","gatherpress")),(0,t.createElement)(o.Button,{className:"components-button is-primary","aria-disabled":this.shouldDisable(),onClick:()=>this.announce(),disabled:this.shouldDisable()},this.state.announceEventSent?Y("Sent","gatherpress"):Y("Send","gatherpress"))))}}const y=()=>(0,t.createElement)(x,null),{registerPlugin:M}=wp.plugins,{__:H}=wp.i18n,{PluginDocumentSettingPanel:k}=wp.editPost;M("gp-event-settings",{render:()=>"gp_event"===wp.data.select("core/editor").getCurrentPostType()&&(0,t.createElement)(k,{name:"gp-event-settings",title:H("Event settings","gatherpress"),initialOpen:!0,className:"gp-event-settings"},(0,t.createElement)(C,null),(0,t.createElement)("hr",null),(0,t.createElement)(y,null)),icon:""})})();