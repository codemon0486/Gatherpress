(()=>{"use strict";var e={n:t=>{var n=t&&t.__esModule?()=>t.default:()=>t;return e.d(n,{a:n}),n},d:(t,n)=>{for(var a in n)e.o(n,a)&&!e.o(t,a)&&Object.defineProperty(t,a,{enumerable:!0,get:n[a]})}};e.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),e.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t);const t=window.wp.element,n=window.moment;var a=e.n(n);const s=window.wp.i18n;function r(){wp.data.dispatch("core/editor").editPost({meta:{_non_existing_meta:!0}})}function i(){return a()().valueOf()>a()(GatherPress.event_datetime.datetime_end).valueOf()}const o=window.wp.apiFetch;var m=e.n(o);const d=window.React,l=window.wp.date;function c(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;f(e),GatherPress.event_datetime.datetime_start=e,this.setState({dateTime:e}),null!==t&&t({dateTime:e}),r()}function u(){return GatherPress.event_datetime.datetime_start=this.state.dateTime,this.state.dateTime}class p extends d.Component{constructor(e){super(e),this.state={dateTime:GatherPress.event_datetime.datetime_start}}componentDidMount(){this.updateDateTimeStart=c,this.getDateTimeStart=u,c=c.bind(this),u=u.bind(this)}componentWillUnmount(){c=this.updateDateTimeStart,u=this.getDateTimeStart}render(){const e=(0,l.__experimentalGetSettings)();return(0,l.dateI18n)(`${e.formats.date} ${e.formats.time}`,this.state.dateTime)}}function h(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;P(e),GatherPress.event_datetime.datetime_end=e,this.setState({dateTime:e}),null!==t&&t({dateTime:e}),r()}function _(){return GatherPress.event_datetime.datetime_end=this.state.dateTime,g(),this.state.dateTime}function g(){const e="gp_event_past",t=wp.data.dispatch("core/notices"),n=i();t.removeNotice(e),n&&t.createNotice("warning",(0,s.__)("This event has already past.","gatherpress"),{id:e,isDismissible:!0})}class v extends d.Component{constructor(e){super(e),this.state={dateTime:GatherPress.event_datetime.datetime_end}}componentDidMount(){this.updateDateTimeEnd=h,this.getDateTimeEnd=_,h=h.bind(this),_=_.bind(this),g()}componentWillUnmount(){h=this.updateDateTimeEnd,_=this.getDateTimeEnd}componentDidUpdate(){g()}render(){const e=(0,l.__experimentalGetSettings)();return(0,l.dateI18n)(`${e.formats.date} ${e.formats.time}`,this.state.dateTime)}}const w="YYYY-MM-DDTHH:mm:ss";function f(e){const t=moment(GatherPress.event_datetime.datetime_end).valueOf(),n=moment(e).valueOf();n>=t&&h(moment(n).add(2,"hours").format(w)),g()}function P(e){const t=moment(GatherPress.event_datetime.datetime_start).valueOf(),n=moment(e).valueOf();n<=t&&c(moment(n).subtract(2,"hours").format(w)),g()}const E=window.wp.components,T=window.wp.compose,D=(0,T.withState)()((e=>{let{setState:n}=e;const a=(0,l.__experimentalGetSettings)(),s=/a(?!\\)/i.test(a.formats.time.toLowerCase().replace(/\\\\/g,"").split("").reverse().join(""));return(0,t.createElement)(E.DateTimePicker,{currentDate:u(),onChange:e=>c(e,n),is12Hour:s})})),b=(0,T.withState)()((e=>{let{setState:n}=e;const a=(0,l.__experimentalGetSettings)(),s=/a(?!\\)/i.test(a.formats.time.toLowerCase().replace(/\\\\/g,"").split("").reverse().join(""));return(0,t.createElement)(E.DateTimePicker,{currentDate:_(),onChange:e=>h(e,n),is12Hour:s})})),{__:S}=wp.i18n,G=moment().format(w);let O=GatherPress.event_datetime.datetime_start,C=GatherPress.event_datetime.datetime_end;wp.data.subscribe((function(){const e=wp.data.select("core/editor").isSavingPost(),t=wp.data.select("core/editor").isAutosavingPost();e&&!t&&m()({path:"/gatherpress/v1/event/datetime/",method:"POST",data:{post_id:GatherPress.post_id,datetime_start:moment(GatherPress.event_datetime.datetime_start).format("YYYY-MM-DD HH:mm:ss"),datetime_end:moment(GatherPress.event_datetime.datetime_end).format("YYYY-MM-DD HH:mm:ss"),_wpnonce:GatherPress.nonce}}).then((e=>{}))})),O=""!==O?moment(O).format(w):G,C=""!==C?moment(C).format(w):moment(G).add(2,"hours").format(w),GatherPress.event_datetime.datetime_start=O,GatherPress.event_datetime.datetime_end=C;const Y=()=>(0,t.createElement)("section",null,(0,t.createElement)("h3",null,S("Date & time","gatherpress")),(0,t.createElement)(E.PanelRow,null,(0,t.createElement)("span",null,S("Start","gatherpress")),(0,t.createElement)(E.Dropdown,{position:"bottom left",renderToggle:e=>{let{isOpen:n,onToggle:a}=e;return(0,t.createElement)(E.Button,{onClick:a,"aria-expanded":n,isLink:!0},(0,t.createElement)(p,null))},renderContent:()=>(0,t.createElement)(D,null)})),(0,t.createElement)(E.PanelRow,null,(0,t.createElement)("span",null,S("End","gatherpress")),(0,t.createElement)(E.Dropdown,{position:"bottom left",renderToggle:e=>{let{isOpen:n,onToggle:a}=e;return(0,t.createElement)(E.Button,{onClick:a,"aria-expanded":n,isLink:!0},(0,t.createElement)(v,null))},renderContent:()=>(0,t.createElement)(b,null)}))),{__:x}=wp.i18n;class y extends d.Component{constructor(e){super(e),this.state={announceEventSent:"0"!==GatherPress.event_announced}}announce(){e.g.confirm(x("Ready to announce this event to all members?","gatherpress"))&&m()({path:"/gatherpress/v1/event/announce/",method:"POST",data:{post_id:GatherPress.post_id,_wpnonce:GatherPress.nonce}}).then((e=>{GatherPress.event_announced=e.success?"1":"0",this.setState({announceEventSent:e.success})}))}shouldDisable(){return this.state.announceEventSent||"publish"!==wp.data.select("core/editor").getEditedPostAttribute("status")||i()}render(){return(0,t.createElement)("section",null,(0,t.createElement)("h3",null,x("Options","gatherpress")),(0,t.createElement)(E.PanelRow,null,(0,t.createElement)("span",null,x("Announce event","gatherpress")),(0,t.createElement)(E.Button,{className:"components-button is-primary","aria-disabled":this.shouldDisable(),onClick:()=>this.announce(),disabled:this.shouldDisable()},this.state.announceEventSent?x("Sent","gatherpress"):x("Send","gatherpress"))))}}const M=()=>(0,t.createElement)(y,null),{registerPlugin:H}=wp.plugins,{__:k}=wp.i18n,{PluginDocumentSettingPanel:j}=wp.editPost;H("gp-event-settings",{render:()=>"gp_event"===wp.data.select("core/editor").getCurrentPostType()&&(0,t.createElement)(j,{name:"gp-event-settings",title:k("Event settings","gatherpress"),initialOpen:!0,className:"gp-event-settings"},(0,t.createElement)(Y,null),(0,t.createElement)("hr",null),(0,t.createElement)(M,null)),icon:""})})();