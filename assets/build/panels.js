!function(){"use strict";var e={n:function(t){var n=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(n,{a:n}),n},d:function(t,n){for(var a in n)e.o(n,a)&&!e.o(t,a)&&Object.defineProperty(t,a,{enumerable:!0,get:n[a]})},o:function(e,t){return Object.prototype.hasOwnProperty.call(e,t)}},t=window.wp.element;function n(){wp.data.dispatch("core/editor").editPost({meta:{_non_existing_meta:!0}})}function a(){return moment().valueOf()>moment(GatherPress.event_datetime.datetime_end).valueOf()}var s=window.wp.apiFetch,r=e.n(s),i=window.React,o=window.wp.date;function m(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;v(e),GatherPress.event_datetime.datetime_start=e,this.setState({dateTime:e}),null!==t&&t({dateTime:e}),n()}function d(){return GatherPress.event_datetime.datetime_start=this.state.dateTime,this.state.dateTime}class l extends i.Component{constructor(e){super(e),this.state={dateTime:GatherPress.event_datetime.datetime_start}}componentDidMount(){this.updateDateTimeStart=m,this.getDateTimeStart=d,m=m.bind(this),d=d.bind(this)}componentWillUnmount(){m=this.updateDateTimeStart,d=this.getDateTimeStart}render(){const e=(0,o.__experimentalGetSettings)();return(0,o.dateI18n)(`${e.formats.date} ${e.formats.time}`,this.state.dateTime)}}var c=window.wp.i18n;function u(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;w(e),GatherPress.event_datetime.datetime_end=e,this.setState({dateTime:e}),null!==t&&t({dateTime:e}),n()}function p(){return GatherPress.event_datetime.datetime_end=this.state.dateTime,h(),this.state.dateTime}function h(){const e="gp_event_past",t=wp.data.dispatch("core/notices"),n=a();t.removeNotice(e),n&&t.createNotice("warning",(0,c.__)("This event has already past.","gatherpress"),{id:e,isDismissible:!0})}class _ extends i.Component{constructor(e){super(e),this.state={dateTime:GatherPress.event_datetime.datetime_end}}componentDidMount(){this.updateDateTimeEnd=u,this.getDateTimeEnd=p,u=u.bind(this),p=p.bind(this),h()}componentWillUnmount(){u=this.updateDateTimeEnd,p=this.getDateTimeEnd}componentDidUpdate(){h()}render(){const e=(0,o.__experimentalGetSettings)();return(0,o.dateI18n)(`${e.formats.date} ${e.formats.time}`,this.state.dateTime)}}const g="YYYY-MM-DDTHH:mm:ss";function v(e){const t=moment(GatherPress.event_datetime.datetime_end).valueOf(),n=moment(e).valueOf();n>=t&&u(moment(n).add(2,"hours").format(g)),h()}function w(e){const t=moment(GatherPress.event_datetime.datetime_start).valueOf(),n=moment(e).valueOf();n<=t&&m(moment(n).subtract(2,"hours").format(g)),h()}var f=window.wp.components,P=window.wp.compose;const E=(0,P.withState)()((e=>{let{setState:n}=e;const a=(0,o.__experimentalGetSettings)(),s=/a(?!\\)/i.test(a.formats.time.toLowerCase().replace(/\\\\/g,"").split("").reverse().join(""));return(0,t.createElement)(f.DateTimePicker,{currentDate:d(),onChange:e=>m(e,n),is12Hour:s})})),T=(0,P.withState)()((e=>{let{setState:n}=e;const a=(0,o.__experimentalGetSettings)(),s=/a(?!\\)/i.test(a.formats.time.toLowerCase().replace(/\\\\/g,"").split("").reverse().join(""));return(0,t.createElement)(f.DateTimePicker,{currentDate:p(),onChange:e=>u(e,n),is12Hour:s})})),{__:D}=wp.i18n,S=moment().format(g);let G=GatherPress.event_datetime.datetime_start,b=GatherPress.event_datetime.datetime_end;wp.data.subscribe((function(){let e=wp.data.select("core/editor").isSavingPost(),t=wp.data.select("core/editor").isAutosavingPost();e&&!t&&r()({path:"/gatherpress/v1/event/datetime/",method:"POST",data:{post_id:GatherPress.post_id,datetime_start:moment(GatherPress.event_datetime.datetime_start).format("YYYY-MM-DD HH:mm:ss"),datetime_end:moment(GatherPress.event_datetime.datetime_end).format("YYYY-MM-DD HH:mm:ss"),_wpnonce:GatherPress.nonce}}).then((e=>{}))})),G=""!==G?moment(G).format(g):S,b=""!==b?moment(b).format(g):moment(S).add(2,"hours").format(g),GatherPress.event_datetime.datetime_start=G,GatherPress.event_datetime.datetime_end=b;const O=()=>(0,t.createElement)("section",null,(0,t.createElement)("h3",null,D("Date & time","gatherpress")),(0,t.createElement)(f.PanelRow,null,(0,t.createElement)("span",null,D("Start","gatherpress")),(0,t.createElement)(f.Dropdown,{position:"bottom left",renderToggle:e=>{let{isOpen:n,onToggle:a}=e;return(0,t.createElement)(f.Button,{onClick:a,"aria-expanded":n,isLink:!0},(0,t.createElement)(l,null))},renderContent:()=>(0,t.createElement)(E,null)})),(0,t.createElement)(f.PanelRow,null,(0,t.createElement)("span",null,D("End","gatherpress")),(0,t.createElement)(f.Dropdown,{position:"bottom left",renderToggle:e=>{let{isOpen:n,onToggle:a}=e;return(0,t.createElement)(f.Button,{onClick:a,"aria-expanded":n,isLink:!0},(0,t.createElement)(_,null))},renderContent:()=>(0,t.createElement)(T,null)}))),{__:C}=wp.i18n;class Y extends i.Component{constructor(e){super(e),this.state={announceEventSent:"0"!==GatherPress.event_announced}}announce(){confirm(C("Ready to announce this event to all members?","gatherpress"))&&r()({path:"/gatherpress/v1/event/announce/",method:"POST",data:{post_id:GatherPress.post_id,_wpnonce:GatherPress.nonce}}).then((e=>{GatherPress.event_announced=e.success?"1":"0",this.setState({announceEventSent:e.success})}))}shouldDisable(){return this.state.announceEventSent||"publish"!==wp.data.select("core/editor").getEditedPostAttribute("status")||a()}render(){return(0,t.createElement)("section",null,(0,t.createElement)("h3",null,C("Options","gatherpress")),(0,t.createElement)(f.PanelRow,null,(0,t.createElement)("span",null,C("Announce event","gatherpress")),(0,t.createElement)(f.Button,{className:"components-button is-primary","aria-disabled":this.shouldDisable(),onClick:()=>this.announce(),disabled:this.shouldDisable()},this.state.announceEventSent?C("Sent","gatherpress"):C("Send","gatherpress"))))}}const x=()=>(0,t.createElement)(Y,null),{registerPlugin:M}=wp.plugins,{__:H}=wp.i18n,{PluginDocumentSettingPanel:k}=wp.editPost;M("gp-event-settings",{render:()=>"gp_event"===wp.data.select("core/editor").getCurrentPostType()&&(0,t.createElement)(k,{name:"gp-event-settings",title:H("Event settings","gatherpress"),initialOpen:!0,className:"gp-event-settings"},(0,t.createElement)(O,null),(0,t.createElement)("hr",null),(0,t.createElement)(x,null)),icon:""})}();