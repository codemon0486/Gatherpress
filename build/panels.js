(()=>{"use strict";var e={n:t=>{var n=t&&t.__esModule?()=>t.default:()=>t;return e.d(n,{a:n}),n},d:(t,n)=>{for(var r in n)e.o(n,r)&&!e.o(t,r)&&Object.defineProperty(t,r,{enumerable:!0,get:n[r]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};const t=window.wp.element,n=window.wp.i18n,r=window.wp.data,a=window.wp.components,i=window.wp.plugins,o=window.wp.editPost,s=window.moment;var l=e.n(s);const m=window.wp.apiFetch;var c=e.n(m);function d(){(0,r.dispatch)("core/editor").editPost({meta:{_non_existing_meta:!0}})}function u(e){if("object"==typeof GatherPress)return e.split(".").reduce(((e,t)=>e&&e[t]),GatherPress)}function p(e,t){if("object"!=typeof GatherPress)return;const n=e.split("."),r=n.pop();n.reduce(((e,t)=>{var n;return null!==(n=e[t])&&void 0!==n?n:e[t]={}}),GatherPress)[r]=t}const _="YYYY-MM-DDTHH:mm:ss",g="YYYY-MM-DD HH:mm:ss",v="MMMM D, YYYY h:mm a",f=(()=>{const e=u("event_datetime.timezone");return l().tz.zone(e)?e:(0,n.__)("GMT","gatherpress")})(),E=((()=>{if((0,n.__)("GMT","gatherpress")!==f)return"";const e=u("event_datetime.timezone");"string"==typeof e&&e.replace(":","")})(),l().tz(f).add(1,"day").set("hour",18).set("minute",0).set("second",0).format(_)),h=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;T(e),p("event_datetime.datetime_start",e),"function"==typeof t&&t(e),d()},w=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;D(e),p("event_datetime.datetime_end",e),null!==t&&t(e),d()};function T(e){const t=l().tz(u("event_datetime.datetime_end"),f).valueOf(),n=l().tz(e,f).valueOf();if(n>=t){const e=l().tz(n,f).add(2,"hours").format(_);w(e)}}function D(e){const t=l().tz(u("event_datetime.datetime_start"),f).valueOf(),n=l().tz(e,f).valueOf();if(n<=t){const e=l().tz(n,f).subtract(2,"hours").format(_);h(e)}}function S(){return"gp_event"===(0,r.select)("core/editor").getCurrentPostType()}function z(){const e="gp_event_past",t=(0,r.dispatch)("core/notices");t.removeNotice(e),function(){const e=l()(u("event_datetime.datetime_end"));return l().tz(f).valueOf()>e.tz(f).valueOf()}()&&t.createNotice("warning",(0,n.__)("This event has already past.","gatherpress"),{id:e,isDismissible:!1})}const P=window.wp.date,b=e=>{const{dateTimeStart:t}=e;return l().tz(t,f).format(v)},x=e=>{const{dateTimeEnd:t}=e;return l().tz(t,f).format(v)},y=e=>{const{dateTimeStart:n,setDateTimeStart:r}=e,i=(0,P.getSettings)(),o=/a(?!\\)/i.test(i.formats.time.toLowerCase().replace(/\\\\/g,"").split("").reverse().join(""));return(0,t.createElement)(a.DateTimePicker,{currentDate:n,onChange:e=>h(e,r),is12Hour:o})},O=e=>{const{dateTimeEnd:n,setDateTimeEnd:r}=e,i=(0,P.getSettings)(),o=/a(?!\\)/i.test(i.formats.time.toLowerCase().replace(/\\\\/g,"").split("").reverse().join(""));return(0,t.createElement)(a.DateTimePicker,{currentDate:n,onChange:e=>w(e,r),is12Hour:o})},C=function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];for(const[n,r]of Object.entries(e)){let e=n;t&&(e+=t);const a=new CustomEvent(e,{detail:r});dispatchEvent(a)}},Y=e=>{const{dateTimeStart:r,setDateTimeStart:i}=e;return(0,t.useEffect)((()=>{i(l().tz((()=>{let e=u("event_datetime.datetime_start");return e=""!==e?l().tz(e,f).format(_):E,p("event_datetime.datetime_start",e),e})(),f).format(_)),C({setDateTimeStart:r}),z()})),(0,t.createElement)(a.PanelRow,null,(0,t.createElement)(a.Flex,null,(0,t.createElement)(a.FlexItem,null,(0,n.__)("Start","gatherpress")),(0,t.createElement)(a.FlexItem,null,(0,t.createElement)(a.Dropdown,{position:"bottom left",renderToggle:e=>{let{isOpen:n,onToggle:i}=e;return(0,t.createElement)(a.Button,{onClick:i,"aria-expanded":n,isLink:!0},(0,t.createElement)(b,{dateTimeStart:r}))},renderContent:()=>(0,t.createElement)(y,{dateTimeStart:r,setDateTimeStart:i})}))))},F=e=>{const{dateTimeEnd:r,setDateTimeEnd:i}=e;return(0,t.useEffect)((()=>{i(l().tz((()=>{let e=u("event_datetime.datetime_end");return e=""!==e?l().tz(e,f).format(_):l().tz(E,f).add(2,"hours").format(_),p("event_datetime.datetime_end",e),e})(),f).format(_)),C({setDateTimeEnd:r}),z()})),(0,t.createElement)(a.PanelRow,null,(0,t.createElement)(a.Flex,null,(0,t.createElement)(a.FlexItem,null,(0,n.__)("End","gatherpress")),(0,t.createElement)(a.FlexItem,null,(0,t.createElement)(a.Dropdown,{position:"bottom left",renderToggle:e=>{let{isOpen:n,onToggle:i}=e;return(0,t.createElement)(a.Button,{onClick:i,"aria-expanded":n,isLink:!0},(0,t.createElement)(x,{dateTimeEnd:r}))},renderContent:()=>(0,t.createElement)(O,{dateTimeEnd:r,setDateTimeEnd:i})}))))};(0,r.subscribe)((function(){const e=(0,r.select)("core/editor").isSavingPost(),t=(0,r.select)("core/editor").isAutosavingPost();S()&&e&&!t&&c()({path:"/gatherpress/v1/event/datetime/",method:"POST",data:{post_id:u("post_id"),datetime_start:l().tz(u("event_datetime.datetime_start"),f).format(g),datetime_end:l().tz(u("event_datetime.datetime_end"),f).format(g),timezone:u("event_datetime.timezone"),_wpnonce:u("nonce")}}).then((()=>{}))}));const M=()=>{const[e,r]=(0,t.useState)(),[a,i]=(0,t.useState)();return(0,t.createElement)("section",null,(0,t.createElement)("h3",null,(0,n.__)("Date & time","gatherpress")),(0,t.createElement)(Y,{dateTimeStart:e,setDateTimeStart:r}),(0,t.createElement)(F,{dateTimeEnd:a,setDateTimeEnd:i}))},k=()=>{const[e,i]=(0,t.useState)(""),o=(0,r.useDispatch)("core/editor").editPost,{unlockPostSaving:s}=(0,r.useDispatch)("core/editor"),l=(0,r.useSelect)((e=>e("core/editor").getEditedPostAttribute("_gp_venue"))),m=(0,r.useSelect)((e=>e("core").getEntityRecord("taxonomy","_gp_venue",l)))?.slug.replace("_venue_",""),c=l+":"+m;(0,t.useEffect)((()=>{var e;i(null!==(e=String(c))&&void 0!==e?e:""),C({setVenueId:m})}));let d=(0,r.useSelect)((e=>e("core").getEntityRecords("taxonomy","_gp_venue",{per_page:-1,context:"view"})),[e]);return d?(d=d.map((e=>({label:e.name,value:e.id+":"+e.slug.replace("_venue_","")}))),d.unshift({value:":",label:(0,n.__)("Choose a venue","gatherpress")})):d=[],(0,t.createElement)(a.PanelRow,null,(0,t.createElement)(a.Flex,null,(0,t.createElement)(a.FlexItem,null,(0,n.__)("Venue","gatherpress")),(0,t.createElement)(a.FlexItem,null,(0,t.createElement)(a.SelectControl,{label:(0,n.__)("Venue","gatherpress"),hideLabelFromVision:"true",value:e,onChange:e=>{(e=>{i(e);const t=""!==(e=e.split(":"))[0]?[e[0]]:[];o({_gp_venue:t}),C({setVenueId:e[1]}),s()})(e)},options:d,style:{width:"11rem"}}))))};(0,i.registerPlugin)("gp-event-settings",{render:()=>S()&&(0,t.createElement)(o.PluginDocumentSettingPanel,{name:"gp-event-settings",title:(0,n.__)("Event settings","gatherpress"),initialOpen:!0,className:"gp-event-settings"},(0,t.createElement)(a.__experimentalVStack,{spacing:2},(0,t.createElement)(M,null),(0,t.createElement)(a.__experimentalDivider,null),(0,t.createElement)(k,null))),icon:""}),(0,r.dispatch)("core/edit-post").toggleEditorPanelOpened("gp-event-settings/gp-event-settings")})();