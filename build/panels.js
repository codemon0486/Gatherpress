(()=>{"use strict";var e={n:t=>{var n=t&&t.__esModule?()=>t.default:()=>t;return e.d(n,{a:n}),n},d:(t,n)=>{for(var a in n)e.o(n,a)&&!e.o(t,a)&&Object.defineProperty(t,a,{enumerable:!0,get:n[a]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};const t=window.wp.element,n=window.wp.i18n,a=window.wp.data,r=window.wp.components,i=window.wp.plugins,o=window.wp.editPost,l=window.moment;var s=e.n(l);const c=window.wp.apiFetch;var m=e.n(c);function d(){(0,a.dispatch)("core/editor").editPost({meta:{_non_existing_meta:!0}})}function u(e){if("object"==typeof GatherPress)return e.split(".").reduce(((e,t)=>e&&e[t]),GatherPress)}function p(e,t){if("object"!=typeof GatherPress)return;const n=e.split("."),a=n.pop();n.reduce(((e,t)=>{var n;return null!==(n=e[t])&&void 0!==n?n:e[t]={}}),GatherPress)[a]=t}const g="YYYY-MM-DDTHH:mm:ss",_="YYYY-MM-DD HH:mm:ss",v="MMMM D, YYYY h:mm a",f=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:u("event_datetime.timezone");return s().tz.zone(e)?e:(0,n.__)("GMT","gatherpress")},E=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";const t=/^(\+|-)(\d{2}):(00|15|30|45)$/,n=e.replace(t,"$1");return n!==e?"UTC"+n+parseInt(e.replace(t,"$2")).toString()+e.replace(t,"$3").replace("00","").replace("15",".25").replace("30",".5").replace("45",".75"):e},h=s().tz(f()).add(1,"day").set("hour",18).set("minute",0).set("second",0).format(g),w=s().tz(h,f()).add(2,"hours").format(g),T=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;z(e),p("event_datetime.datetime_start",e),"function"==typeof t&&t(e),d()},S=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;D(e),p("event_datetime.datetime_end",e),null!==t&&t(e),d()};function z(e){const t=s().tz(u("event_datetime.datetime_end"),f()).valueOf(),n=s().tz(e,f()).valueOf();if(n>=t){const e=s().tz(n,f()).add(2,"hours").format(g);S(e)}}function D(e){const t=s().tz(u("event_datetime.datetime_start"),f()).valueOf(),n=s().tz(e,f()).valueOf();if(n<=t){const e=s().tz(n,f()).subtract(2,"hours").format(g);T(e)}}function P(){return u("post_type")===(0,a.select)("core/editor").getCurrentPostType()}function b(){const e="gp_event_past",t=(0,a.dispatch)("core/notices");t.removeNotice(e),function(){const e=s()(u("event_datetime.datetime_end"));return s().tz(f()).valueOf()>e.tz(f()).valueOf()}()&&t.createNotice("warning",(0,n.__)("This event has already past.","gatherpress"),{id:e,isDismissible:!1})}const y=window.wp.date,x=e=>{const{dateTimeStart:t}=e;return s().tz(t,f()).format(v)},C=e=>{const{dateTimeEnd:t}=e;return s().tz(t,f()).format(v)},O=e=>{const{dateTimeStart:n,setDateTimeStart:a}=e,i=(0,y.getSettings)(),o=/a(?!\\)/i.test(i.formats.time.toLowerCase().replace(/\\\\/g,"").split("").reverse().join(""));return(0,t.createElement)(r.DateTimePicker,{currentDate:n,onChange:e=>T(e,a),is12Hour:o})},k=e=>{const{dateTimeEnd:n,setDateTimeEnd:a}=e,i=(0,y.getSettings)(),o=/a(?!\\)/i.test(i.formats.time.toLowerCase().replace(/\\\\/g,"").split("").reverse().join(""));return(0,t.createElement)(r.DateTimePicker,{currentDate:n,onChange:e=>S(e,a),is12Hour:o})},Y=function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];for(const[n,a]of Object.entries(e)){let e=n;t&&(e+=t);const r=new CustomEvent(e,{detail:a});dispatchEvent(r)}},F=e=>{const{dateTimeStart:a,setDateTimeStart:i}=e;return(0,t.useEffect)((()=>{i(s().tz((()=>{let e=u("event_datetime.datetime_start");return e=""!==e?s().tz(e,f()).format(g):h,p("event_datetime.datetime_start",e),e})(),f()).format(g)),Y({setDateTimeStart:a}),b()})),(0,t.createElement)(r.PanelRow,null,(0,t.createElement)(r.Flex,null,(0,t.createElement)(r.FlexItem,null,(0,n.__)("Start","gatherpress")),(0,t.createElement)(r.FlexItem,null,(0,t.createElement)(r.Dropdown,{position:"bottom left",renderToggle:e=>{let{isOpen:n,onToggle:i}=e;return(0,t.createElement)(r.Button,{onClick:i,"aria-expanded":n,isLink:!0},(0,t.createElement)(x,{dateTimeStart:a}))},renderContent:()=>(0,t.createElement)(O,{dateTimeStart:a,setDateTimeStart:i})}))))},M=e=>{const{dateTimeEnd:a,setDateTimeEnd:i}=e;return(0,t.useEffect)((()=>{i(s().tz((()=>{let e=u("event_datetime.datetime_end");return e=""!==e?s().tz(e,f()).format(g):w,p("event_datetime.datetime_end",e),e})(),f()).format(g)),Y({setDateTimeEnd:a}),b()})),(0,t.createElement)(r.PanelRow,null,(0,t.createElement)(r.Flex,null,(0,t.createElement)(r.FlexItem,null,(0,n.__)("End","gatherpress")),(0,t.createElement)(r.FlexItem,null,(0,t.createElement)(r.Dropdown,{position:"bottom left",renderToggle:e=>{let{isOpen:n,onToggle:i}=e;return(0,t.createElement)(r.Button,{onClick:i,"aria-expanded":n,isLink:!0},(0,t.createElement)(C,{dateTimeEnd:a}))},renderContent:()=>(0,t.createElement)(k,{dateTimeEnd:a,setDateTimeEnd:i})}))))},j=e=>{const{timezone:a,setTimezone:i}=e,o=u("timezone_choices");return(0,t.useEffect)((()=>{i(u("event_datetime.timezone"))}),[]),(0,t.useEffect)((()=>{Y({setTimezone:u("event_datetime.timezone")})})),(0,t.createElement)(r.PanelRow,null,(0,t.createElement)(r.SelectControl,{label:(0,n.__)("Time Zone"),value:E(a),onChange:e=>{e=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";const t=/^UTC(\+|-)(\d+)(.\d+)?$/,n=e.replace(t,"$1");if(n!==e){const a=e.replace(t,"$2").padStart(2,"0");let r=e.replace(t,"$3");return""===r&&(r=":00"),r=r.replace(".25",":15").replace(".5",":30").replace(".75",":45"),n+a+r}return e}(e),i(e),p("event_datetime.timezone",e),d()}},Object.keys(o).map((e=>(0,t.createElement)("optgroup",{key:e,label:e},Object.keys(o[e]).map((n=>(0,t.createElement)("option",{key:n,value:n},o[e][n]))))))))};(0,a.subscribe)((function(){const e=(0,a.select)("core/editor").isSavingPost(),t=(0,a.select)("core/editor").isAutosavingPost();P()&&e&&!t&&m()({path:"/gatherpress/v1/event/datetime/",method:"POST",data:{post_id:u("post_id"),datetime_start:s().tz(u("event_datetime.datetime_start"),f()).format(_),datetime_end:s().tz(u("event_datetime.datetime_end"),f()).format(_),timezone:u("event_datetime.timezone"),_wpnonce:u("nonce")}}).then((()=>{}))}));const $=()=>{const[e,a]=(0,t.useState)(),[r,i]=(0,t.useState)(),[o,l]=(0,t.useState)();return(0,t.createElement)("section",null,(0,t.createElement)("h3",null,(0,n.__)("Date & time","gatherpress")),(0,t.createElement)(F,{dateTimeStart:e,setDateTimeStart:a}),(0,t.createElement)(M,{dateTimeEnd:r,setDateTimeEnd:i}),(0,t.createElement)(j,{timezone:o,setTimezone:l}))},I=()=>{const[e,i]=(0,t.useState)(""),o=(0,a.useDispatch)("core/editor").editPost,{unlockPostSaving:l}=(0,a.useDispatch)("core/editor"),s=(0,a.useSelect)((e=>e("core/editor").getEditedPostAttribute("_gp_venue"))),c=(0,a.useSelect)((e=>e("core").getEntityRecord("taxonomy","_gp_venue",s))),m=c?.slug.slice(1,c?.slug.length),d=s+":"+m;(0,t.useEffect)((()=>{var e;i(null!==(e=String(d))&&void 0!==e?e:""),Y({setVenueSlug:m})}));let u=(0,a.useSelect)((e=>e("core").getEntityRecords("taxonomy","_gp_venue",{per_page:-1,context:"view"})),[e]);return u?(u=u.map((e=>({label:e.name,value:e.id+":"+e.slug.slice(1,e.slug.length)}))),u.unshift({value:":",label:(0,n.__)("Choose a venue","gatherpress")})):u=[],(0,t.createElement)(r.PanelRow,null,(0,t.createElement)(r.Flex,null,(0,t.createElement)(r.FlexItem,null,(0,n.__)("Venue","gatherpress")),(0,t.createElement)(r.FlexItem,null,(0,t.createElement)(r.SelectControl,{label:(0,n.__)("Venue","gatherpress"),hideLabelFromVision:"true",value:e,onChange:e=>{(e=>{i(e);const t=""!==(e=e.split(":"))[0]?[e[0]]:[];o({_gp_venue:t}),Y({setVenueSlug:e[1]}),l()})(e)},options:u,style:{width:"11rem"}}))))};(0,i.registerPlugin)("gp-event-settings",{render:()=>P()&&(0,t.createElement)(o.PluginDocumentSettingPanel,{name:"gp-event-settings",title:(0,n.__)("Event settings","gatherpress"),initialOpen:!0,className:"gp-event-settings"},(0,t.createElement)(r.__experimentalVStack,{spacing:2},(0,t.createElement)($,null),(0,t.createElement)(r.__experimentalDivider,null),(0,t.createElement)(I,null))),icon:""}),(0,a.dispatch)("core/edit-post").toggleEditorPanelOpened("gp-event-settings/gp-event-settings")})();