(()=>{"use strict";var e={n:t=>{var s=t&&t.__esModule?()=>t.default:()=>t;return e.d(s,{a:s}),s},d:(t,s)=>{for(var n in s)e.o(s,n)&&!e.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:s[n]})}};e.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),e.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t);const t=window.React,s=window.wp.domReady;var n=e.n(s);const a=window.wp.element,r=window.wp.i18n,i=window.wp.components,l=window.wp.blockEditor,o=window.wp.apiFetch;var c=e.n(o);const p=(e,t="")=>{for(const[s,n]of Object.entries(e)){let e=s;t&&(e+="_"+String(t)),addEventListener(e,(e=>{n(e.detail)}),!1)}};function m(e){if("object"==typeof GatherPress)return e.split(".").reduce(((e,t)=>e&&e[t]),GatherPress)}window.wp.data;const d=({item:e,activeItem:s=!1,count:n,onTitleClick:r,defaultLimit:i})=>{const{title:l,value:o}=e,c=!(0===n&&"attending"!==o),p=s?"span":"a",d=m("post_id"),v=n>i;return(0,a.useEffect)((()=>{s&&((e,t="")=>{for(const[s,n]of Object.entries(e)){let e=s;t&&(e+="_"+String(t));const a=new CustomEvent(e,{detail:n});dispatchEvent(a)}})({setRsvpSeeAllLink:v},d)})),c?(0,t.createElement)("div",{className:"gp-rsvp-response__navigation-item"},(0,t.createElement)(p,{className:"gp-rsvp-response__anchor","data-item":o,"data-toggle":"tab",href:"#",role:"tab","aria-controls":`#gp-rsvp-${o}`,onClick:e=>r(e,o)},l),(0,t.createElement)("span",{className:"gp-rsvp-response__count"},"(",n,")")):""},v=({items:s,activeValue:n,onTitleClick:r,defaultLimit:i})=>{const l={all:0,attending:0,not_attending:0,waiting_list:0};for(const[e,t]of Object.entries(m("responses")))l[e]=t.count;const[o,c]=(0,a.useState)(l),[v,u]=(0,a.useState)(!1),[_,g]=(0,a.useState)(!0),E=_?"span":"a";p({setRsvpCount:c},m("post_id"));let f=0;const h=s.map(((e,s)=>{const a=e.value===n;return a&&(f=s),(0,t.createElement)(d,{key:s,item:e,count:o[e.value],activeItem:a,onTitleClick:r,defaultLimit:i})}));return(0,a.useEffect)((()=>{e.g.document.addEventListener("click",(({target:e})=>{e.closest(".gp-rsvp-response__navigation-active")||u(!1)})),e.g.document.addEventListener("keydown",(({key:e})=>{"Escape"===e&&u(!1)}))})),(0,a.useEffect)((()=>{0===o.not_attending&&0===o.waiting_list?g(!0):g(!1)}),[o]),(0,t.createElement)("div",{className:"gp-rsvp-response__navigation-wrapper"},(0,t.createElement)("div",null,(0,t.createElement)(E,{href:"#",className:"gp-rsvp-response__navigation-active",onClick:e=>(e=>{e.preventDefault(),u(!v)})(e)},s[f].title),"Â ",(0,t.createElement)("span",null,"(",o[n],")")),!_&&v&&(0,t.createElement)("nav",{className:"gp-rsvp-response__navigation"},h))},u=({items:e,activeValue:s,onTitleClick:n,rsvpLimit:i,setRsvpLimit:l,defaultLimit:o})=>{let c;c=!1===i?(0,r.__)("See fewer","gatherpress"):(0,r.__)("See all","gatherpress");const[d,u]=(0,a.useState)(m("responses")[s].count>o);return p({setRsvpSeeAllLink:u},m("post_id")),(0,t.createElement)("div",{className:"gp-rsvp-response__header"},(0,t.createElement)("div",{className:"dashicons dashicons-groups"}),(0,t.createElement)(v,{items:e,activeValue:s,onTitleClick:n,defaultLimit:o}),d&&(0,t.createElement)("div",{className:"gp-rsvp-response__see-all"},(0,t.createElement)("a",{href:"#",onClick:e=>(e=>{e.preventDefault(),l(!1===i&&o)})(e)},c)))},_=({value:e,limit:s,responses:n=[]})=>{let a="";return"object"==typeof n&&void 0!==n[e]&&(n=[...n[e].responses],s&&(n=n.splice(0,s)),a=n.map(((e,s)=>{const{profile:n,name:a,photo:r,role:i}=e;let{guests:l}=e;return l=l?" +"+l+" guest(s)":"",(0,t.createElement)("div",{key:s,className:"gp-rsvp-response__item"},(0,t.createElement)("figure",{className:"gp-rsvp-response__member-avatar"},""!==n?(0,t.createElement)("a",{href:n},(0,t.createElement)("img",{alt:a,title:a,src:r})):(0,t.createElement)("img",{alt:a,title:a,src:r})),(0,t.createElement)("div",{className:"gp-rsvp-response__member-info"},(0,t.createElement)("div",{className:"gp-rsvp-response__member-name"},""!==n?(0,t.createElement)("a",{href:n,title:a},a):(0,t.createElement)("span",null,a)),(0,t.createElement)("div",{className:"gp-rsvp-response__member-role"},i),(0,t.createElement)("small",{className:"gp-rsvp-response__guests"},l)))}))),(0,t.createElement)(t.Fragment,null,"attending"===e&&0===a.length&&(0,t.createElement)("div",{className:"gp-rsvp-response__no-responses"},!1===m("has_event_past")?(0,r.__)("No one is attending this event yet.","gatherpress"):(0,r.__)("No one went to this event.","gatherpress")),a)},g=({items:e,activeValue:s,limit:n=!1,editMode:r})=>{const i=m("post_id"),[l,o]=(0,a.useState)(m("responses"));p({setRsvpResponse:o},i);const c=e.map(((e,a)=>{const{value:r}=e;return r===s?(0,t.createElement)("div",{key:a,className:"gp-rsvp-response__items",id:`gp-rsvp-${r}`,role:"tabpanel","aria-labelledby":`gp-rsvp-${r}-tab`},(0,t.createElement)(_,{value:r,limit:n,responses:l})):""}));return(0,t.createElement)("div",{className:"gp-rsvp-response__content"},c)},E=()=>{const e=m("has_event_past"),s=[{title:!1===e?(0,r.__)("Attending","gatherpress"):(0,r.__)("Went","gatherpress"),value:"attending"},{title:!1===e?(0,r.__)("Waiting List","gatherpress"):(0,r.__)("Wait Listed","gatherpress"),value:"waiting_list"},{title:!1===e?(0,r.__)("Not Attending","gatherpress"):(0,r.__)("Didn't Go","gatherpress"),value:"not_attending"}],[n,o]=(0,a.useState)("attending"),[d,v]=(0,a.useState)(8),[_,E]=(0,a.useState)(!1),[f,h]=(0,a.useState)(m("responses"));p({setRsvpStatus:o},m("post_id"));const w=m("post_id"),b=f.attending.responses;return(0,t.createElement)(t.Fragment,null,(0,t.createElement)(l.InspectorControls,null,(0,t.createElement)(i.PanelBody,null,(0,t.createElement)("p",null,(0,r.__)("Event List type","gatherpress")),(0,t.createElement)(i.Button,{variant:"secondary",onClick:e=>{e.preventDefault(),E(!_)}},"Edit Attendees")),(0,t.createElement)(i.FormTokenField,{key:"query-controls-topics-select",label:(0,r.__)("Attendees","gatherpress"),value:b&&b.map((e=>({id:e.id,name:e.name,value:e.name}))),onChange:async e=>{let t=0;b.forEach((s=>{!1===e.some((e=>e.id===s.id))&&(t=s.id)})),c()({path:"/gatherpress/v1/event/rsvp",method:"POST",data:{post_id:w,status:"remove",user_id:t,_wpnonce:m("nonce")}}).then((e=>{h(e.responses)}))}})),(0,t.createElement)("div",{className:"gp-rsvp-response"},(0,t.createElement)(u,{items:s,activeValue:n,onTitleClick:(e,t)=>{e.preventDefault(),o(t)},rsvpLimit:d,setRsvpLimit:v,defaultLimit:8}),(0,t.createElement)(g,{items:s,activeValue:n,limit:d,editMode:_})))};n()((()=>{const e=document.querySelectorAll('[data-gp_block_name="rsvp-response"]');for(let s=0;s<e.length;s++)(0,a.createRoot)(e[s]).render((0,t.createElement)(E,null))}))})();